<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Technical Help</title>
  <meta name="description" content="Professional Technical Help by Charles Russo." />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://your-domain.com/" />
  <meta property="og:title" content="Technical Help - Professional Development Services" />
  <meta property="og:description" content="Affordable development freelancing services for fullstack development, prototype manufacturing, and technical expertise." />
  <meta property="og:image" content="https://your-domain.com/media/embedimage.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="Technical Help Services - Charles Russo" />
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://your-domain.com/" />
  <meta property="twitter:title" content="Technical Help - Professional Development Services" />
  <meta property="twitter:description" content="Affordable development freelancing services for fullstack development, prototype manufacturing, and technical expertise." />
  <meta property="twitter:image" content="https://your-domain.com/media/embedimage.png" />
  <meta property="twitter:image:alt" content="Technical Help Services - Charles Russo" />
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
  <style>
    :root{
      /* Background Colors */
      --bg-primary: #000;
      --bg-card: rgba(0,0,0,0.72);
      --bg-card-boot: rgba(0,0,0,0.6);
      --bg-overlay: rgba(0,0,0,0.8);
      --bg-form: rgba(0,0,0,0.85);
      --bg-input: rgba(0,0,0,0.8);
      
      /* Text Colors */
      --text-primary: #d7ffe1;
      --text-secondary: #a9f5b3;
      --text-muted: rgb(132, 255, 176);
      --text-hero: #84ffb0;
      --text-terminal: #84ffb0;
      --text-label: #a9f5b3;
      --text-button: #01210c;
      --text-button-secondary: #a9f5b3;
      --text-email: #b6f7c6;
      --text-footer: #7aff8a;
      --text-success: #7fff9f;
      --text-error: #ff6b6b;
      
      /* Accent Colors */
      --accent-primary: #00ff41;
      --accent-secondary: #18ff66;
      --accent-glow: #00ff4147;
      --accent-dim: rgba(0,255,65,0.18);
      --accent-border: rgba(0,255,65,0.25);
      --accent-border-focus: rgba(0,255,65,0.5);
      --accent-shadow: rgba(0,255,65,0.3);
      
      /* Button Colors */
      --btn-primary-bg: linear-gradient(180deg, rgba(0,255,65,0.95), rgba(0,255,65,0.75));
      --btn-primary-border: rgba(0,255,65,0.25);
      --btn-primary-shadow: var(--accent-dim);
      --btn-form-bg: rgba(0,0,0,0.8);
      --btn-form-border: #00ff41;
      --btn-form-hover: rgba(0,255,65,0.1);
      
      /* Border Colors */
      --border-primary: rgba(0,255,65,0.18);
      --border-form: #00ff41;
      --border-input: rgba(0,255,65,0.2);
      --border-input-focus: rgba(0,255,65,0.5);
      
      /* Shadow Colors */
      --shadow-card: 0 20px 70px var(--accent-dim);
      --shadow-form: 0 20px 60px rgba(0,255,65,0.15);
      --shadow-button: 0 10px 30px var(--accent-dim);
      --shadow-glow: 0 0 20px rgba(0,255,65,0.4);
      
      /* Status Colors */
      --status-success: #00ff41;
      --status-loading: #00ff41;
      --status-error: #ff6b6b;
    }
    *{ box-sizing: border-box; }
    html, body{ height:100%; margin:0; background:var(--bg-primary); color:var(--text-primary); }
    body{ overflow:hidden; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial; }

    /* Canvas fills screen behind everything */
    #matrixCanvas{ position:fixed; inset:0; width:100vw; height:100vh; display:block; z-index:0; }

    /* Top label */
    .badge{
      position: absolute; left: 12px; top: 12px; z-index: 5; user-select:none; pointer-events:none;
    }
    .badge .label{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:11px; letter-spacing:.22em; color: var(--text-secondary); opacity:.9; }
    .badge .bar{ height:4px; width:88px; border-radius:999px; background: var(--accent-secondary); margin-top:6px; animation:pulse 1.2s ease-in-out infinite; }
    @keyframes pulse{ 0%,100%{opacity:.35} 50%{opacity:1} }

    /* Boot overlay */
    #boot{
      position:fixed; inset:0; z-index: 10;
      display:grid; place-items:center;
      background: var(--bg-overlay); backdrop-filter: blur(4px);
      transition: all 0.8s cubic-bezier(0.23, 1, 0.32, 1);
    }
    .boot-card{
      width:min(960px, 92vw);
      background: var(--bg-card-boot);
      border:1px solid var(--accent-border);
      border-radius:24px;
      padding: clamp(20px, 4vw, 48px);
      box-shadow: var(--shadow-card);
      position: relative;
      will-change: transform, opacity, background, border-color, box-shadow;
    }
    .terminal{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono","Courier New", monospace;
      color: var(--text-terminal);
      font-size: clamp(13px, 2.5vw, 16px);
      line-height: 1.5;
      white-space: pre-wrap;
      min-height: 7em;
      will-change: transform, opacity;
      position: relative;
    }
    .hero-text {
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-hero);
      font-size: clamp(20px, 4.25vw, 51px);
      line-height: 1.05;
      font-weight: 800;
      text-align: center;
      padding: 0 10px;
      margin: 0 0 8px 0;
      text-shadow: 
        0 0 20px var(--accent-glow),
        0 0 40px var(--accent-dim);
      will-change: transform, opacity;
      position: relative;
    }
    
    .typing-text {
      opacity: 0;
    }
    
    
    .boot-card .hero-text {
      position: absolute;
      inset: 0;
      margin: 0;
      opacity: 0;
      transform: translateY(20px) scale(0.95);
    }
    
    .card .hero-text {
      opacity: 0;
      transform: translateY(20px) scale(0.95);
    }
    
    .card.show .hero-text {
      opacity: 1;
      transform: translateY(0) scale(1);
      transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .boot-controls{
      margin-top:12px; display:flex; align-items:center; justify-content:space-between; gap:12px;
      color:#9af4ae; font-size:12px;
    }
    .btn-skip{
      border:1px solid rgba(0,255,65,.35);
      background: rgba(0,255,65,.06);
      color:#c9ffda;
      border-radius:8px;
      padding:6px 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-weight:700;
      cursor:pointer;
    }
    .btn-skip:hover{ background: rgba(0,255,65,.12); }
    .cursor{ display:inline-block; width:10px; animation: blink 1s steps(1) infinite; }
    @keyframes blink { 50%{ opacity: 0; } }

    /* CTA Card */
    .wrap{
      position:relative; z-index: 2; height: 100dvh;
      display:grid; place-items:center; padding: clamp(12px, 3vw, 28px);
    }

    .card{
      width:min(960px, 100%);
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: 24px;
      backdrop-filter: blur(6px);
      box-shadow: var(--shadow-card);
      padding: clamp(20px, 4vw, 48px);
      text-align:center;
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.8s cubic-bezier(0.23, 1, 0.32, 1);
    }
    .card.show{ 
      opacity: 1;
      transform: translateY(0);
    }
    
    
    .tagline {
      opacity: 0;
      transform: translateY(15px);
      transition: all 0.8s cubic-bezier(0.23, 1, 0.32, 1) 0.4s;
    }
    
    .card.show .tagline {
      opacity: 1;
      transform: translateY(0);
    }
    
    .actions > * {
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    }
    
    .actions > *:nth-child(1) {
      transition-delay: 0.6s;
    }
    
    .actions > *:nth-child(2) {
      transition-delay: 0.8s;
    }
    
    .actions > *:nth-child(3) {
      transition-delay: 1.0s;
    }
    
    .card.show .actions > * {
      opacity: 1;
      transform: translateY(0);
    }

    p.tagline{ margin: 0 0 20px; color: var(--text-secondary); font-size: clamp(14px, 2.4vw, 18px); }

    .actions{ display:flex; gap:12px; flex-wrap:wrap; justify-content:center; }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      min-height:48px; padding: 0 20px;
      border-radius: 999px;
      border: 1px solid var(--btn-primary-border);
      background: var(--btn-primary-bg);
      color: var(--text-button); font-weight:800; text-decoration:none; letter-spacing:.3px;
      box-shadow: var(--shadow-button);
    }
    .btn:hover{ filter: brightness(1.06); }
    .email{
      display:inline-flex; align-items:center; gap:10px;
      color: var(--text-email);
      font-weight:600; text-decoration:none;
      border: 1px solid var(--border-input);
      padding: 10px 14px; border-radius: 12px;
      background: var(--btn-form-hover);
    }
    .email:hover{ color: var(--text-primary); border-color: var(--accent-border); background: var(--accent-dim); }

    footer{ margin-top: clamp(16px, 2.5vw, 24px); font-size: 12px; color: var(--text-footer); opacity:.9; }

    /* Mobile and tablet text size increases */
    @media (max-width: 768px) and (min-width: 481px){
      .hero-text { font-size: clamp(30px, 6.5vw, 76px); }
      p.tagline { font-size: clamp(11px, 1.9vw, 14px); }
    }

    @media (max-width: 480px){
      .actions{ gap:10px; }
      .btn{ width:100%; min-height:52px; font-size:16px; }
      .email{ width:100%; justify-content:center; }
      
      /* Mobile text size increases */
      .hero-text { font-size: clamp(40px, 8.5vw, 102px); }
      p.tagline { font-size: clamp(11px, 1.9vw, 14px); }
      
      /* Mobile line breaks for hero text */
      .typing-text .line1,
      .typing-text .line2,
      .typing-text .line3 {
        display: block;
      }
      
      /* Mobile line breaks for tagline text */
      .tagline-line1,
      .tagline-line2 {
        display: block;
        white-space: nowrap;
      }
    }

    /* Terminal Form Modal */
    #formModal{
      position: fixed; inset: 0; z-index: 20;
      display: grid; place-items: center; padding: 20px;
      background: rgba(0,0,0,0);
      backdrop-filter: blur(0px);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s cubic-bezier(0.23, 1, 0.32, 1), 
                  background-color 0.5s cubic-bezier(0.23, 1, 0.32, 1),
                  backdrop-filter 0.5s cubic-bezier(0.23, 1, 0.32, 1),
                  visibility 0s linear 0.5s;
    }
    #formModal.show{ 
      opacity: 1;
      visibility: visible;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(8px);
      transition: opacity 0.5s cubic-bezier(0.23, 1, 0.32, 1), 
                  background-color 0.5s cubic-bezier(0.23, 1, 0.32, 1),
                  backdrop-filter 0.5s cubic-bezier(0.23, 1, 0.32, 1);
    }
    .form-container{
      width: min(700px, 100%); max-height: 90vh; overflow-y: auto;
      background: var(--bg-form);
      border: 2px solid var(--border-form);
      border-radius: 12px;
      padding: clamp(16px, 3vw, 24px);
      box-shadow: 
        0 30px 100px rgba(0,255,65,0.25),
        0 10px 40px rgba(0,0,0,0.8),
        0 0 0 1px rgba(0,255,65,0.1);
      position: relative;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      opacity: 0;
      transform: scale(0.7) translateY(60px);
      transition: all 0.7s cubic-bezier(0.16, 1, 0.3, 1);
      will-change: transform, opacity;
    }
    #formModal.show .form-container{
      opacity: 1;
      transform: scale(1) translateY(0);
    }
    .form-header{
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 20px; padding-bottom: 12px;
      border-bottom: 1px solid #00ff41;
    }
    .form-title{
      font-size: clamp(16px, 3vw, 20px);
      color: var(--text-hero); margin: 0;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      text-shadow: var(--shadow-glow);
      letter-spacing: 1px;
    }
    .form-title:before{ content: "> "; }
    .close-btn{
      background: var(--bg-input); 
      border: 1px solid var(--border-form); 
      color: var(--text-hero);
      font-size: 16px; cursor: pointer; 
      padding: 4px 8px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      transition: all 0.2s;
    }
    .close-btn:hover{ 
      background: var(--btn-form-hover); 
      box-shadow: var(--shadow-glow);
    }
    
    .form-group{
      margin-bottom: 16px;
      transform: translateX(-40px);
      opacity: 0;
      transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .form-group.animate-in{
      transform: translateX(0);
      opacity: 1;
    }
    
    .form-label{
      opacity: 0;
      transform: translateX(-20px);
      transition: all 0.4s ease-out;
    }
    .form-label.animate-in{
      opacity: 1;
      transform: translateX(0);
    }
    
    .form-input, .form-textarea, .form-select{
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .form-input.animate-in, .form-textarea.animate-in, .form-select.animate-in{
      opacity: 1;
      transform: translateY(0);
    }
    
    .form-label{
      display: block; margin-bottom: 6px;
      color: var(--text-label); font-weight: 400;
      font-size: 13px; letter-spacing: 0.5px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }
    .form-label:before{ content: "$ "; color: var(--text-hero); }
    
    .form-input, .form-textarea, .form-select{
      width: 100%; padding: 10px 12px;
      background: var(--bg-input);
      border: 1px solid var(--border-form);
      border-radius: 0; color: var(--text-muted);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: 13px;
      box-shadow: inset 0 0 10px var(--accent-dim);
    }
    .form-input:focus, .form-textarea:focus, .form-select:focus{
      outline: none;
      border-color: var(--border-input-focus);
      background: var(--bg-form);
      box-shadow: 
        inset 0 0 10px var(--accent-border),
        var(--shadow-glow);
      color: var(--text-primary);
    }
    .form-textarea{
      resize: vertical; min-height: 80px;
      line-height: 1.4;
    }
    .form-select{
      cursor: pointer;
    }
    .form-select option{
      background: #000; color: #84ffb0;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }
    
    .form-input::placeholder, .form-textarea::placeholder{
      color: rgba(132,255,176,0.5);
      font-style: italic;
    }
    
    .form-actions{
      display: flex; gap: 12px; margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid rgba(0,255,65,0.3);
    }
    .btn-submit{
      flex: 1; min-height: 40px;
      background: var(--btn-form-bg);
      border: 1px solid var(--btn-form-border);
      color: var(--text-hero);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-weight: 700; font-size: 14px;
      cursor: pointer; transition: all 0.3s;
      letter-spacing: 1px;
    }
    .btn-submit:hover{
      background: var(--btn-form-hover);
      box-shadow: var(--shadow-glow);
      text-shadow: var(--shadow-glow);
    }
    .btn-submit:disabled{
      opacity: 0.5; cursor: not-allowed;
      background: var(--btn-form-bg);
      box-shadow: none; text-shadow: none;
    }
    .btn-cancel{
      padding: 10px 20px;
      background: var(--btn-form-bg);
      border: 1px solid var(--text-muted);
      color: var(--text-muted);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-weight: 600; cursor: pointer;
      transition: all 0.3s; font-size: 14px;
    }
    .btn-cancel:hover{
      background: var(--btn-form-hover);
      border-color: var(--text-muted);
      box-shadow: var(--shadow-glow);
    }
    
    /* Form States */
    #helpForm .form-group,
    #helpForm .form-actions {
      transition: opacity 0.3s ease-out;
    }
    
    /* Loading State */
    .loading{
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      color: var(--status-loading);
      font-size: 14px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      text-align: center;
      padding: 20px;
      background: rgba(0,255,65,0.05);
      border: 1px solid var(--status-loading);
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      opacity: 0;
      transition: opacity 0.3s ease-out;
    }
    .loading.show{
      display: flex;
      opacity: 1;
    }
    
    .loading-content {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .loading-content:before{
      content: "> ";
      color: var(--status-loading);
    }
    
    .spinner{
      width: 20px;
      height: 20px;
      border: 2px solid var(--accent-border);
      border-top: 2px solid var(--status-loading);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    .loading-dots {
      display: inline-flex;
      gap: 4px;
    }
    .loading-dots span {
      width: 4px;
      height: 4px;
      background: var(--status-loading);
      border-radius: 50%;
      animation: loadingDots 1.4s ease-in-out infinite both;
    }
    .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
    .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
    .loading-dots span:nth-child(3) { animation-delay: 0s; }
    
    @keyframes spin{ 0%{ transform: rotate(0deg); } 100%{ transform: rotate(360deg); } }
    @keyframes loadingDots {
      0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }
    
    /* Success State */
    .success-message{
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.95);
      display: none;
      text-align: center;
      padding: 40px 20px;
      color: var(--status-success);
      font-size: 14px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      border: 2px solid var(--status-success);
      background: rgba(0,255,65,0.1);
      margin: 0;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0,255,65,0.2);
      min-height: 120px;
      width: 90%;
      max-width: 400px;
      opacity: 0;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: all 0.3s ease-out;
    }
    .success-message.show{
      display: flex;
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
    .success-message h3{
      margin: 0 0 16px 0;
      font-size: 20px;
      text-shadow: var(--shadow-glow);
      font-weight: 700;
    }
    .success-message h3:before{ content: "> "; }
    .success-message p{ 
      margin: 0;
      opacity: 0.9; 
      font-size: 14px;
      line-height: 1.5;
      max-width: 400px;
    }
    

    /* QR Code Button */
    .qr-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--accent-dim);
      border: 2px solid var(--accent-border);
      color: var(--text-primary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 100;
      box-shadow: var(--shadow-glow);
    }

    .qr-button:hover {
      transform: scale(1.1);
      background: var(--accent-bright);
      box-shadow: 0 0 20px rgba(0,255,65,0.3);
    }

    /* QR Code Modal */
    .qr-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(3px);
      display: none;
      place-items: center;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .qr-modal.show {
      display: grid;
      opacity: 1;
    }

    .qr-container {
      background: var(--bg-card);
      border: 2px solid var(--accent-border);
      border-radius: 12px;
      padding: 32px;
      position: relative;
      text-align: center;
      max-width: 90%;
      width: 320px;
      transform: scale(0.95);
      opacity: 0;
      transition: all 0.3s ease;
      box-shadow: var(--shadow-glow);
    }

    .qr-modal.show .qr-container {
      transform: scale(1);
      opacity: 1;
    }

    .qr-close {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 30px;
      height: 30px;
      border: none;
      background: none;
      color: var(--text-muted);
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.3s ease;
    }

    .qr-close:hover {
      color: var(--text-primary);
    }

    .qr-container h3 {
      color: var(--text-primary);
      font-size: 20px;
      margin: 0 0 24px 0;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }

    .qr-container p {
      color: var(--text-muted);
      font-size: 14px;
      margin: 24px 0 0 0;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }

    #qrCode {
      background: #00ff4147;
      padding: 16px;
      border-radius: 8px;
      display: inline-block;
      line-height: 0;
    }

    #qrCode img {
      max-width: 200px;
      height: auto;
    }

    /* Affiliate Modal Styles */
    .affiliate-modal {
      position: fixed; inset: 0; z-index: 20;
      display: grid; place-items: center; padding: 20px;
      background: rgba(0,0,0,0);
      backdrop-filter: blur(0px);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s cubic-bezier(0.23, 1, 0.32, 1), 
                  background-color 0.5s cubic-bezier(0.23, 1, 0.32, 1),
                  backdrop-filter 0.5s cubic-bezier(0.23, 1, 0.32, 1),
                  visibility 0s linear 0.5s;
    }
    
    .affiliate-modal.show { 
      opacity: 1;
      visibility: visible;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(8px);
      transition: opacity 0.5s cubic-bezier(0.23, 1, 0.32, 1), 
                  background-color 0.5s cubic-bezier(0.23, 1, 0.32, 1),
                  backdrop-filter 0.5s cubic-bezier(0.23, 1, 0.32, 1);
    }
    
    .affiliate-container {
      width: min(600px, 100%); max-height: 90vh; overflow-y: auto;
      background: var(--bg-form);
      border: 2px solid var(--border-form);
      border-radius: 12px;
      padding: clamp(16px, 3vw, 24px);
      box-shadow: 
        0 30px 100px rgba(0,255,65,0.25),
        0 10px 40px rgba(0,0,0,0.8),
        0 0 0 1px rgba(0,255,65,0.1);
      position: relative;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      opacity: 0;
      transform: scale(0.7) translateY(60px);
      transition: all 0.7s cubic-bezier(0.16, 1, 0.3, 1);
      will-change: transform, opacity;
    }
    
    .affiliate-modal.show .affiliate-container {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
    
    .affiliate-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 20px; padding-bottom: 12px;
      border-bottom: 1px solid #00ff41;
    }
    
    .affiliate-title {
      font-size: clamp(16px, 3vw, 20px);
      color: var(--text-hero); margin: 0;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      text-shadow: var(--shadow-glow);
      letter-spacing: 1px;
    }
    
    .affiliate-title:before { content: "> "; }
    
    .affiliate-content {
      text-align: center;
    }
    
    .affiliate-icon {
      font-size: 48px;
      margin-bottom: 16px;
      display: block;
    }
    
    .affiliate-content h3 {
      color: var(--text-hero);
      font-size: clamp(18px, 3vw, 24px);
      margin: 0 0 16px 0;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      text-shadow: var(--shadow-glow);
    }
    
    .affiliate-content p {
      color: var(--text-secondary);
      font-size: clamp(14px, 2vw, 16px);
      line-height: 1.5;
      margin: 0 0 24px 0;
    }
    
    .affiliate-link-container {
      margin: 24px 0;
      text-align: left;
    }
    
    .link-display {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }
    
    .affiliate-link-text {
      flex: 1;
      background: var(--bg-input);
      border: 1px solid var(--border-form);
      color: var(--text-hero);
      font-size: 12px;
      padding: 8px 12px;
      border-radius: 0;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      box-shadow: inset 0 0 10px var(--accent-dim);
      word-break: break-all;
      line-height: 1.4;
      min-height: 20px;
      display: flex;
      align-items: center;
    }
    
    .btn-copy {
      background: var(--btn-form-bg);
      border: 1px solid var(--btn-form-border);
      color: var(--text-hero);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-weight: 700; font-size: 12px;
      cursor: pointer; transition: all 0.3s;
      padding: 8px 16px;
      white-space: nowrap;
    }
    
    .btn-copy:hover {
      background: var(--btn-form-hover);
      box-shadow: var(--shadow-glow);
    }
    
    .affiliate-terms {
      background: var(--bg-input);
      border: 1px solid var(--accent-border);
      border-radius: 8px;
      padding: 16px;
      margin: 24px 0;
      text-align: left;
    }
    
    .affiliate-terms h4 {
      color: var(--text-hero);
      font-size: 16px;
      margin: 0 0 12px 0;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }
    
    .affiliate-terms ul {
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.5;
      margin: 0;
      padding-left: 20px;
    }
    
    .affiliate-terms li {
      margin-bottom: 8px;
    }
    
    .affiliate-terms a {
      color: var(--text-hero);
      text-decoration: underline;
    }
    
    .affiliate-terms a:hover {
      color: var(--accent-primary);
    }
    
    /* Affiliate form animation states (same as client form) */
    #affiliateForm .form-group {
      transform: translateX(-40px);
      opacity: 0;
      transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    #affiliateForm .form-group.animate-in {
      transform: translateX(0);
      opacity: 1;
    }
    
    #affiliateForm .form-label {
      opacity: 0;
      transform: translateX(-20px);
      transition: all 0.4s ease-out;
    }
    
    #affiliateForm .form-label.animate-in {
      opacity: 1;
      transform: translateX(0);
    }
    
    #affiliateForm .form-input {
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    #affiliateForm .form-input.animate-in {
      opacity: 1;
      transform: translateY(0);
    }

    /* Mobile Responsive Form */
    @media (max-width: 768px){
      #formModal{ padding: 12px; }
      .form-container{
        width: 100%; max-height: 95vh;
        padding: 16px;
        font-size: 12px;
      }
      .form-title{ font-size: 16px; }
      .form-label{ font-size: 12px; }
      .form-input, .form-textarea, .form-select{
        font-size: 12px; padding: 8px 10px;
      }
      .form-textarea{ min-height: 60px; }
      .form-actions{ 
        flex-direction: column; gap: 8px;
        margin-top: 16px; padding-top: 12px;
      }
      .btn-submit, .btn-cancel{
        width: 100%; min-height: 44px;
        font-size: 13px;
      }
      .form-group{ margin-bottom: 12px; }
      
      /* Affiliate Modal Mobile */
      .affiliate-modal { padding: 12px; }
      .affiliate-container {
        width: 100%; max-height: 95vh;
        padding: 16px;
        font-size: 12px;
      }
      .affiliate-title { font-size: 16px; }
      .affiliate-content h3 { font-size: 18px; }
      .affiliate-content p { font-size: 14px; }
      .link-display { flex-direction: column; }
      .btn-copy { width: 100%; }
    }

    @media (max-width: 480px){
      .form-container{
        padding: 12px; font-size: 11px;
        border-width: 1px;
      }
      .form-title{ font-size: 14px; }
      .form-label{ font-size: 11px; }
      .form-input, .form-textarea, .form-select{
        font-size: 11px; padding: 6px 8px;
      }
      .close-btn{ font-size: 14px; padding: 2px 6px; }
      .btn-submit, .btn-cancel{ min-height: 40px; }
    }

    @media (prefers-reduced-motion: reduce){
      .bar, .card, .form-container, .form-group{ 
        animation: none !important; 
        transition: none !important;
      }
      #boot{ transition: none !important; }
    }
  </style>
</head>
<body>
  <canvas id="matrixCanvas"></canvas>

  <!-- Boot overlay -->
  <div id="boot" aria-live="polite">
      <div class="boot-card" role="status" aria-label="Boot sequence">
        <div id="terminal" class="terminal"></div>
        <div class="hero-text">DOES YOUR BUSINESS NEED TECHNICAL EXPERTISE?</div>
        <div class="boot-controls">
          <span class="tip" aria-hidden="true">Tip: press "Skip" to jump ahead.</span>
          <button id="skipBtn" class="btn-skip" type="button">Skip</button>
        </div>
      </div>
  </div>

  <!-- Static label -->
  <div class="badge" aria-hidden="true">
    <div class="label">Charlie Russo</div>
    <div class="bar"></div>
  </div>

  <!-- CTA -->
  <main class="wrap">
    <section id="card" class="card" role="region" aria-label="Technical help call to action">
      <div class="hero-text">
        <span class="typing-text">
          <span class="line1"></span>
          <span class="line2"></span>
          <span class="line3"></span>
        </span>
      </div>
      <p class="tagline">
        <span class="tagline-line1">Affordable development freelancing services for</span>
        <span class="tagline-line2">fullstack development, prototype manufacturing, etc.</span>
      </p>
      <div class="actions">
        <button class="btn" id="openFormBtn" type="button">Fill out Your Inquiry Here</button>
        <button class="btn btn-affiliate" id="openAffiliateBtn" type="button">Become an Affiliate</button>
        <a class="email" href="mailto:russoc2023@fau.edu" aria-label="Email russoc2023 at fau dot edu">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7Z" stroke="currentColor" stroke-width="1.6"/>
            <path d="m4 7 8 6 8-6" stroke="currentColor" stroke-width="1.6"/>
          </svg>
          russoc2023@fau.edu
        </a>
      </div>
    </section>
  </main>

  <!-- Form Modal -->
  <div id="formModal" aria-hidden="true">
    <div class="form-container" role="dialog" aria-labelledby="formTitle">
      <div class="form-header">
        <h2 id="formTitle" class="form-title">Technical Help Request</h2>
        <button class="close-btn" id="closeFormBtn" type="button" aria-label="Close form">&times;</button>
      </div>
      
      <form id="helpForm">
        <div class="form-group">
          <label class="form-label" for="name">Full Name *</label>
          <input type="text" id="name" name="name" class="form-input" required>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="email">Email Address *</label>
          <input type="email" id="email" name="email" class="form-input" required>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="phone">Phone Number</label>
          <input type="tel" id="phone" name="phone" class="form-input">
        </div>
        
        <div class="form-group">
          <label class="form-label" for="urgency">Project Budget *</label>
          <select id="urgency" name="urgency" class="form-select" required>
            <option value="">Select Budget</option>
            <option value="low">50-100 USD</option>
            <option value="medium">100-500 USD</option>
            <option value="high">500-1000 USD</option>
            <option value="critical">Infinite Money</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="category">Issue Category *</label>
          <select id="category" name="category" class="form-select" required>
            <option value="">Select category</option>
            <option value="web">Website Development</option>
            <option value="software">Backened Development</option>
            <option value="3d">3D-Printing / 3D-Modeling</option>
            <option value="electronics">Electronics Prototyping</option>
            <option value="training">Software Training</option>
            <option value="other">Other</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="description">What do you want developed? *</label>
          <textarea id="description" name="description" class="form-textarea" 
                    placeholder="Please describe what you need developed for your project."
                    required></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="device">Your Website (if it exists)</label>
          <input type="text" id="device" name="device" class="form-input" 
                 placeholder="domain.com">
        </div>
        
        <div class="loading" id="loadingState">
          <div class="loading-content">
            <div class="spinner"></div>
            <span>Sending your request</span>
            <div class="loading-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
          <div style="font-size: 12px; opacity: 0.8; margin-top: 8px;">
            Processing your inquiry and sending notifications
          </div>
        </div>
        
        <div class="success-message" id="successMessage">
          <h3>✅ Your inquiry has been sent out!</h3>
          <p>Check your email for extra information. I'll get back to you as soon as possible.</p>
          <button type="button" class="btn-cancel" id="successCloseBtn" style="margin-top: 20px; font-size: 12px; padding: 8px 16px;">Close</button>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-cancel" id="cancelBtn">Cancel</button>
          <button type="submit" class="btn-submit" id="submitBtn">Send Request</button>
        </div>
      </form>
    </div>
  </div>

  <!-- QR Code Button -->
  <button id="qrButton" class="qr-button" aria-label="Show QR Code">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="3" y="3" width="7" height="7"></rect>
      <rect x="14" y="3" width="7" height="7"></rect>
      <rect x="14" y="14" width="7" height="7"></rect>
      <rect x="3" y="14" width="7" height="7"></rect>
    </svg>
  </button>

  <!-- QR Code Modal -->
  <div id="qrModal" class="qr-modal" aria-hidden="true">
    <div class="qr-container">
      <button type="button" class="qr-close" id="closeQrBtn" aria-label="Close QR Code">×</button>
      <h3>Scan to Visit</h3>
      <div id="qrCode">
        <img src="media/qr-code2.png" alt="QR Code" width="200" height="200">
      </div>
      <p>Scan this QR code with your phone's camera to visit this website</p>
    </div>
  </div>

  <!-- Affiliate Modal -->
  <div id="affiliateModal" class="affiliate-modal" aria-hidden="true">
    <div class="affiliate-container" role="dialog" aria-labelledby="affiliateTitle">
      <div class="affiliate-header">
        <h2 id="affiliateTitle" class="affiliate-title">Become an Affiliate</h2>
        <button class="close-btn" id="closeAffiliateBtn" type="button" aria-label="Close affiliate form">&times;</button>
      </div>
      
      <!-- Step 1: Email Input -->
      <div class="affiliate-step" id="affiliateStep1">
        <div class="affiliate-content">
          <div class="affiliate-icon">💰</div>
          <h3>Get Rewarded for Referrals!</h3>
          <p>Would you like to get rewarded for referring people to our technical services? Type your email below to get your personalized affiliate link.</p>
          
          <form id="affiliateForm">
            <div class="form-group">
              <label class="form-label" for="affiliateEmail">Your Email Address *</label>
              <input type="email" id="affiliateEmail" name="affiliateEmail" class="form-input" 
                     placeholder="your.email@example.com" required>
            </div>
            
            <div class="form-actions">
              <button type="button" class="btn-cancel" id="cancelAffiliateBtn">Cancel</button>
              <button type="submit" class="btn-submit" id="generateLinkBtn">Generate My Link</button>
            </div>
          </form>
        </div>
      </div>
      
      <!-- Step 2: Success with Link -->
      <div class="affiliate-step" id="affiliateStep2" style="display: none;">
        <div class="affiliate-content">
          <div class="affiliate-icon">🎉</div>
          <h3>Welcome to the Affiliate Program!</h3>
          <p>Thank you for becoming an affiliate of Charlie Russo Technical Services. When you send the link below to someone who requires technical freelancing, you will get an email when they submit an inquiry.</p>
          
          <div class="affiliate-link-container">
            <label class="form-label">Your Affiliate Link:</label>
            <div class="link-display">
              <div id="generatedLink" class="affiliate-link-text"></div>
              <button type="button" class="btn-copy" id="copyLinkBtn">Copy</button>
            </div>
          </div>
          
          <div class="affiliate-terms">
            <h4>What happens next?</h4>
            <ul>
              <li>We'll keep you updated on whether they follow through with the process</li>
              <li>You will receive a percentage of our profit</li>
              <li>To negotiate this amount, please email <a href="mailto:russoc2023@fau.edu">russoc2023@fau.edu</a></li>
            </ul>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-cancel" id="closeAffiliateSuccessBtn">Close</button>
            <button type="button" class="btn-submit" id="shareLinkBtn">Share Link</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Utilities =====
    const $ = (sel) => document.querySelector(sel);

    // ===== Matrix Canvas =====
    (function matrix() {
      const canvas = document.getElementById("matrixCanvas");
      const ctx = canvas.getContext("2d");
      const FONT_FAMILY = "ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace";
      const BASE_FONT_SIZE = 18;
      const TRAIL_FADE = 0.04;
      const CHARS = ("アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワン" +
                      "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@$%#*-+=<>" +
                      "abcdefghijklmnopqrstuvwxyz").split("");

      let width=0, height=0, dpr=1, fontSize=BASE_FONT_SIZE, columns=0, drops=[];
      function resize(){
        dpr = window.devicePixelRatio || 1;
        width = canvas.clientWidth = window.innerWidth;
        height = canvas.clientHeight = window.innerHeight;
        canvas.width = Math.floor(width * dpr);
        canvas.height = Math.floor(height * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);
        fontSize = Math.max(14, Math.min(BASE_FONT_SIZE, Math.floor(width / 40)));
        ctx.font = fontSize + "px " + FONT_FAMILY;
        columns = Math.max(1, Math.floor(width / fontSize));
        drops = new Array(columns).fill(1 + Math.floor(Math.random() * 50));
      }
      function frame(){
        ctx.fillStyle = "rgba(0,0,0,"+TRAIL_FADE+")";
        ctx.fillRect(0,0,width,height);
        ctx.fillStyle = "#00ff4a";
        ctx.textBaseline = "top";
        for(let i=0;i<columns;i++){
          const char = CHARS[(Math.random()*CHARS.length)|0];
          const x = i * fontSize;
          const y = drops[i] * fontSize;
          ctx.fillText(char, x, y);
          if (y > height && Math.random() > 0.992) drops[i] = 0;
          drops[i]++;
        }
        requestAnimationFrame(frame);
      }
      resize();
      ctx.fillStyle = "#000"; ctx.fillRect(0,0,width,height);
      requestAnimationFrame(frame);
      window.addEventListener("resize", () => { resize(); ctx.clearRect(0,0,width,height); });
    })();

    // ===== Boot Typewriter (~1 second total) =====
    (function boot() {
      const lines = [
        "INIT SYS: waking matrix renderer…",
        "GPU: context ok  ✅  DPR=" + (window.devicePixelRatio || 1),
        "SEED: entropy ready",
        "NET: establishing secure link ▒▒▒▒▒▒▒▒▒ 100%",
        "STATUS: online",
        "> launch help()",
        "help(): Do you need technical help? — i dont think anyone is reading this lol",
      ];
      const term = $("#terminal");
      const skipBtn = $("#skipBtn");
      const boot = $("#boot");
      const card = $("#card");

      // Build containers per line
      term.innerHTML = lines.map(() => '<div class="ln"></div>').join("");
      const nodes = [...term.querySelectorAll(".ln")];

      // Compute total chars to finish in ~600ms
      const totalDuration = 600;
      const totalChars = lines.reduce((s,l)=>s+l.length,0);
      const step = Math.max(1, Math.floor(totalDuration / totalChars));

      let li=0, ci=0, done=false;
      function type(){
        if(done) return;
        const line = lines[li] || "";
        nodes[li].textContent = (li === lines.length-1 ? "> " : "> ") + line.slice(0, ci+1);
        // Add blinking cursor to current line
        nodes.forEach((n,i)=>{
          n.innerHTML = (i===li)
            ? n.textContent + '<span class="cursor">█</span>'
            : n.textContent;
        });

        ci++;
        if(ci < line.length){
          setTimeout(type, step);
        } else {
          li++; ci=0;
          if(li < lines.length){
            setTimeout(type, step);
          } else {
            // Completed: fade out boot, reveal card
            done = true;
            setTimeout(() => finish(), 200);
          }
        }
      }

      function finish(){
        const bootCard = $('.boot-card');
        const terminal = $('.terminal');
        const bootControls = $('.boot-controls');

        // Immediately hide boot controls
        bootControls.style.display = 'none';
        const typingText = $('.typing-text');
        const line1 = $('.line1');
        const line2 = $('.line2');
        const line3 = $('.line3');
        
        // Create morphing timeline with spring-like easing
        const morphTimeline = anime.timeline({
          easing: 'cubicBezier(0.22, 1, 0.36, 1)'
        });

        // Add animations to timeline
        morphTimeline
          // Fade out background
          .add({
            targets: boot,
            background: ['rgba(0,0,0,0.8)', 'rgba(0,0,0,0)'],
            backdropFilter: ['blur(4px)', 'blur(0px)'],
            duration: 600
          }, 0)
          // Fade out terminal text
          .add({
            targets: terminal,
            opacity: [1, 0],
            scale: [1, 0.9],
            translateY: [0, -10],
            duration: 300,
            easing: 'easeOutQuad'
          }, 0)
          // Morph the card
          .add({
            targets: bootCard,
            background: ['rgba(0,0,0,0.6)', 'rgba(0,0,0,0.72)'],
            borderColor: ['rgba(0,255,65,0.25)', 'rgba(0,255,65,0.18)'],
            boxShadow: [
              '0 20px 70px rgba(0,255,65,0.18)',
              '0 20px 70px rgba(0,255,65,0.28)'
            ],
            translateY: [0, 30],
            scale: {
              value: [1, 1.02, 1],
              duration: 1000,
              easing: 'cubicBezier(0.34, 1.56, 0.64, 1)'
            },
            complete: () => {
              // Hide boot overlay and show main card
              boot.style.display = 'none';
              card.classList.add('show');
              
              // Start typing animation
              typingText.style.opacity = '1';
              
              // Animate each line with typing effect (2x faster, smoother)
              const lines = ['DOES YOUR', 'BUSINESS NEED', 'TECHNICAL EXPERTISE?'];
              const lineElements = [line1, line2, line3];
              
              let currentLine = 0;
              let currentChar = 0;
              
              function typeNextChar() {
                if (currentLine < lines.length) {
                  const line = lines[currentLine];
                  const element = lineElements[currentLine];
                  
                  if (currentChar < line.length) {
                    element.textContent = line.slice(0, currentChar + 1);
                    currentChar++;
                    setTimeout(typeNextChar, 25); // Much faster, smoother typing
                  } else {
                    // Move to next line
                    currentLine++;
                    currentChar = 0;
                    setTimeout(typeNextChar, 50); // Shorter pause between lines
                  }
                }
              }
              
              // Start typing animation immediately
              setTimeout(typeNextChar, 100);
            }
          }, 150);
      }

      skipBtn.addEventListener("click", () => { done = true; finish(); });
      setTimeout(type, 50);
    })();

    // ===== Form Modal & EmailJS =====
    (function formHandler() {
      // EmailJS Configuration
      const EMAILJS_CONFIG = {
        publicKey: 'koG6eWbBRll3MwQU9', // Your EmailJS public key
        serviceId: 'service_0r9aneq', // Your EmailJS service ID for client emails
        referralServiceId: 'service_3uom8fe', // Your EmailJS service ID for referral emails (separate service)
        templateId: 'template_4uw5t74', // Your EmailJS template ID for client emails
        referralTemplateId: 'template_0gw81ok' // Your EmailJS template ID for referral emails
      };

      // Initialize EmailJS
      emailjs.init(EMAILJS_CONFIG.publicKey);
      
      // SECURITY CHECK: Ensure client and referral services are different
      if (EMAILJS_CONFIG.serviceId === EMAILJS_CONFIG.referralServiceId) {
        console.error('🚨 CRITICAL SECURITY ISSUE: Client and referral services are the same!');
        console.error('🚨 This could cause sensitive client data to be sent to referrers!');
        console.error('🚨 Client Service ID:', EMAILJS_CONFIG.serviceId);
        console.error('🚨 Referral Service ID:', EMAILJS_CONFIG.referralServiceId);
      } else {
        console.log('✅ Security check passed: Client and referral services are different');
        console.log('✅ Client Service ID:', EMAILJS_CONFIG.serviceId);
        console.log('✅ Referral Service ID:', EMAILJS_CONFIG.referralServiceId);
      }

      // ===== Referral System =====
      const REFERRAL_COOKIE_NAME = 'techHelpReferrer';
      const REFERRAL_COOKIE_EXPIRY_DAYS = 30; // Referral attribution lasts 30 days

      // Extract referrer from URL and store in cookie
      function handleReferralTracking() {
        const urlParams = new URLSearchParams(window.location.search);
        const referrerEmail = urlParams.get('ref');
        
        if (referrerEmail && isValidEmail(referrerEmail)) {
          console.log('🎯 Referrer tracked from URL:', referrerEmail);
          
          // Note: We're keeping the ?ref= parameter in the URL for simplicity
          // This way we can always read it directly from the URL
          
          // Optional: Show a subtle indication that referral was detected
          // (for debugging purposes - remove in production)
          if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            console.log('🔗 Referral link detected! Referrer:', referrerEmail);
          }
        }
      }

      // Get current referrer from URL parameter
      function getReferrer() {
        const urlParams = new URLSearchParams(window.location.search);
        const referrer = urlParams.get('ref');
        console.log('🔍 getReferrer() called, URL param value:', referrer);
        return referrer && isValidEmail(referrer) ? referrer : null;
      }

      // Validate email format
      function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }

      // Initialize referral tracking on page load
      handleReferralTracking();

      // Debug function to check current referrer (for testing)
      window.checkReferrer = function() {
        const referrer = getReferrer();
        if (referrer) {
          console.log('✅ Current referrer from URL:', referrer);
          return referrer;
        } else {
          console.log('❌ No referrer found in URL');
          return null;
        }
      };

      // Debug function to simulate referral (for testing)
      window.simulateReferral = function(email) {
        if (isValidEmail(email)) {
          const newUrl = new URL(window.location);
          newUrl.searchParams.set('ref', email);
          window.history.replaceState({}, document.title, newUrl.toString());
          console.log('🧪 Simulated referral for:', email);
          console.log('🔍 Current referrer after simulation:', getReferrer());
          return true;
        } else {
          console.log('❌ Invalid email format');
          return false;
        }
      };

      // Debug function to test the complete email system
      window.testEmailSystem = function() {
        console.log('🧪 Testing email system...');
        console.log('📧 EmailJS Config:', EMAILJS_CONFIG);
        console.log('📧 Client Service ID:', EMAILJS_CONFIG.serviceId);
        console.log('📧 Referral Service ID:', EMAILJS_CONFIG.referralServiceId);
        console.log('📧 Client Template ID:', EMAILJS_CONFIG.templateId);
        console.log('📧 Referral Template ID:', EMAILJS_CONFIG.referralTemplateId);
        console.log('🔍 Current referrer:', getReferrer());
        console.log('✅ Email system test complete');
      };

      // Debug function to verify service IDs are different
      window.verifyServices = function() {
        console.log('🔍 Service verification:');
        console.log('Client service:', EMAILJS_CONFIG.serviceId);
        console.log('Referral service:', EMAILJS_CONFIG.referralServiceId);
        console.log('Are they different?', EMAILJS_CONFIG.serviceId !== EMAILJS_CONFIG.referralServiceId);
      };

      // NEW: Function to help diagnose EmailJS configuration issues
      window.checkEmailJSConfig = function() {
        console.log('🔍 EMAILJS CONFIGURATION CHECK:');
        console.log('=====================================');
        console.log('Public Key:', EMAILJS_CONFIG.publicKey);
        console.log('Client Service ID:', EMAILJS_CONFIG.serviceId);
        console.log('Referral Service ID:', EMAILJS_CONFIG.referralServiceId);
        console.log('Client Template ID:', EMAILJS_CONFIG.templateId);
        console.log('Referral Template ID:', EMAILJS_CONFIG.referralTemplateId);
        console.log('=====================================');
        
        // Check for common configuration issues
        if (EMAILJS_CONFIG.serviceId === EMAILJS_CONFIG.referralServiceId) {
          console.error('🚨 ISSUE: Client and referral services are the same!');
        }
        
        if (EMAILJS_CONFIG.templateId === EMAILJS_CONFIG.referralTemplateId) {
          console.error('🚨 ISSUE: Client and referral templates are the same!');
        }
        
        console.log('📋 NEXT STEPS:');
        console.log('1. Go to your EmailJS dashboard');
        console.log('2. Check that service_0r9aneq is configured to send emails TO russoc2023@fau.edu');
        console.log('3. Check that service_3uom8fe is configured to send emails TO the referrer email');
        console.log('4. Verify that template_4uw5t74 uses the client.md template');
        console.log('5. Verify that template_0gw81ok uses the refer.md template');
        console.log('6. Make sure each service has the correct "To Email" configuration');
      };

      // Debug function to test referral service directly
      window.testReferralService = async function() {
        console.log('🧪 Testing referral service directly...');
        
        const testParams = {
          to_name: 'Test User',
          to_email: 'therealjesusman@gmail.com',
          from_name: 'Charlie Russo',
          from_email: 'russoc2023@fau.edu',
          reply_to: 'russoc2023@fau.edu',
          email2: 'therealjesusman@gmail.com', // Template recipient variable
          from_name: 'Test Client',
          timestamp: new Date().toLocaleString()
        };
        
        try {
          const response = await emailjs.send(
            EMAILJS_CONFIG.referralServiceId,
            EMAILJS_CONFIG.referralTemplateId,
            testParams,
            EMAILJS_CONFIG.publicKey
          );
          console.log('✅ Test referral email sent:', response);
        } catch (error) {
          console.error('❌ Test referral email failed:', error);
        }
      };

      // NEW: Diagnostic function to test EmailJS services in isolation
      window.diagnoseEmailJS = async function() {
        console.log('🔍 DIAGNOSTIC: Testing EmailJS services in isolation...');
        
        // Test 1: Send ONLY client email
        console.log('🧪 TEST 1: Sending ONLY client email...');
        const clientOnlyParams = {
          to_name: 'Charlie Russo',
          to_email: 'russoc2023@fau.edu',
          from_name: 'Diagnostic Test',
          from_email: 'test@example.com',
          reply_to: 'test@example.com',
          name: 'Diagnostic Test',
          email: 'test@example.com',
          phone: 'Test Phone',
          urgency: 'medium',
          category: 'web',
          description: 'This is a diagnostic test - client email only',
          device: 'test.com',
          project_budget: '100-500 USD',
          project_category: 'Website Development',
          project_description: 'This is a diagnostic test - client email only',
          existing_website: 'test.com',
          client_name: 'Diagnostic Test',
          client_email: 'test@example.com',
          timestamp: new Date().toLocaleString()
        };
        
        try {
          const clientResponse = await emailjs.send(
            EMAILJS_CONFIG.serviceId,
            EMAILJS_CONFIG.templateId,
            clientOnlyParams,
            EMAILJS_CONFIG.publicKey
          );
          console.log('✅ CLIENT EMAIL ONLY sent successfully:', clientResponse);
          console.log('🔍 Check if referrer received this email (they should NOT)');
        } catch (error) {
          console.error('❌ Client email failed:', error);
        }
        
        // Wait 2 seconds between tests
        setTimeout(async () => {
          // Test 2: Send ONLY referral email
          console.log('🧪 TEST 2: Sending ONLY referral email...');
          const referralOnlyParams = {
            to_name: 'Test Referrer',
            to_email: 'therealjesusman@gmail.com',
            from_name: 'Charlie Russo',
            from_email: 'russoc2023@fau.edu',
            reply_to: 'russoc2023@fau.edu',
            email2: 'therealjesusman@gmail.com',
            from_email2: 'therealjesusman@gmail.com',
            from_name: 'Diagnostic Test Client',
            timestamp: new Date().toLocaleString()
          };
          
          try {
            const referralResponse = await emailjs.send(
              EMAILJS_CONFIG.referralServiceId,
              EMAILJS_CONFIG.referralTemplateId,
              referralOnlyParams,
              EMAILJS_CONFIG.publicKey
            );
            console.log('✅ REFERRAL EMAIL ONLY sent successfully:', referralResponse);
            console.log('🔍 Check if referrer received this email (they SHOULD)');
          } catch (error) {
            console.error('❌ Referral email failed:', error);
          }
        }, 2000);
      };

      // Debug function to manually check cookie
      window.checkCookie = function() {
        console.log('🍪 Cookie name:', REFERRAL_COOKIE_NAME);
        console.log('🍪 Cookie value:', getCookie(REFERRAL_COOKIE_NAME));
        console.log('🍪 All cookies:', document.cookie);
      };
      

      // Modal elements
      const modal = $('#formModal');
      const openBtn = $('#openFormBtn');
      const closeBtn = $('#closeFormBtn');
      const cancelBtn = $('#cancelBtn');
      const form = $('#helpForm');
      const submitBtn = $('#submitBtn');
      const loadingState = $('#loadingState');
      const successMessage = $('#successMessage');
      

      // Cookie utilities
      const COOKIE_NAME = 'techHelpFormData';
      const COOKIE_EXPIRY_DAYS = 7;

      function setCookie(name, value, days) {
        const expires = new Date();
        expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
        document.cookie = `${name}=${encodeURIComponent(value)};expires=${expires.toUTCString()};path=/`;
      }

      function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for(let i = 0; i < ca.length; i++) {
          let c = ca[i];
          while (c.charAt(0) === ' ') c = c.substring(1, c.length);
          if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
        }
        return null;
      }

      function deleteCookie(name) {
        document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/`;
      }

      // Save form data to cookies
      function saveFormData() {
        const formData = new FormData(form);
        const data = {};
        for (let [key, value] of formData.entries()) {
          if (value.trim()) data[key] = value;
        }
        if (Object.keys(data).length > 0) {
          setCookie(COOKIE_NAME, JSON.stringify(data), COOKIE_EXPIRY_DAYS);
        }
      }

      // Load form data from cookies
      function loadFormData() {
        const savedData = getCookie(COOKIE_NAME);
        if (savedData) {
          try {
            const data = JSON.parse(savedData);
            Object.entries(data).forEach(([key, value]) => {
              const field = form.querySelector(`[name="${key}"]`);
              if (field) field.value = value;
            });
          } catch (e) {
            console.warn('Failed to load saved form data:', e);
          }
        }
      }

      // Auto-save form data on input
      function setupAutoSave() {
        const inputs = form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
          input.addEventListener('input', saveFormData);
          input.addEventListener('change', saveFormData);
        });
      }

      // Open modal
      function openModal() {
        document.body.style.overflow = 'hidden';
        modal.setAttribute('aria-hidden', 'false');
        loadFormData();
        
        // Trigger smooth fade in
        requestAnimationFrame(() => {
          modal.classList.add('show');
          
          // Animate form elements one by one after container appears
          setTimeout(() => {
            animateFormElements();
          }, 700); // Wait for form container to fully appear
        });
      }
      
      // Animate form elements one by one
      function animateFormElements() {
        const formGroups = form.querySelectorAll('.form-group');
        const formActions = form.querySelector('.form-actions');
        
        // Animate each form group with typing effect
        formGroups.forEach((group, index) => {
          setTimeout(() => {
            // Animate the group container
            group.classList.add('animate-in');
            
            // Animate label and input separately
            const label = group.querySelector('.form-label');
            const input = group.querySelector('.form-input, .form-textarea, .form-select');
            
            if (label) {
              setTimeout(() => {
                label.classList.add('animate-in');
              }, 200);
            }
            
            if (input) {
              setTimeout(() => {
                input.classList.add('animate-in');
                
                // Focus first empty field
                if (index === 0) {
                  setTimeout(() => {
                    const firstEmpty = form.querySelector('input:not([value]), input[value=""]') || $('#name');
                    firstEmpty.focus();
                  }, 300);
                }
              }, 400);
            }
          }, index * 300); // Stagger each group by 300ms
        });
        
        // Animate form actions last
        if (formActions) {
          setTimeout(() => {
            formActions.style.opacity = '0';
            formActions.style.transform = 'translateY(20px)';
            formActions.style.transition = 'all 0.6s cubic-bezier(0.16, 1, 0.3, 1)';
            
            requestAnimationFrame(() => {
              formActions.style.opacity = '1';
              formActions.style.transform = 'translateY(0)';
            });
          }, formGroups.length * 300 + 200);
        }
      }

      // Close modal
      function closeModal() {
        modal.classList.remove('show');
        modal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
        
        // Wait for fade out animation to complete
        setTimeout(() => {
          resetForm();
        }, 500); // Match the CSS transition duration
      }

      // Reset form (but keep saved data)
      function resetForm() {
        // Hide loading and success states
        loadingState.classList.remove('show');
        successMessage.classList.remove('show');
        submitBtn.disabled = false;
        
        // Restore form fields
        const formGroups = form.querySelectorAll('.form-group');
        const formActions = form.querySelector('.form-actions');
        
        formGroups.forEach(group => {
          group.style.opacity = '1';
          group.style.pointerEvents = 'auto';
          group.style.display = '';
        });
        
        if (formActions) {
          formActions.style.opacity = '1';
          formActions.style.pointerEvents = 'auto';
          formActions.style.display = '';
        }
        
        // Don't reset form data - keep user input
      }

      // Clear form and cookies
      function clearFormData() {
        form.reset();
        deleteCookie(COOKIE_NAME);
      }

      // Show loading state
      function showLoading() {
        // Fade out form fields
        const formGroups = form.querySelectorAll('.form-group');
        const formActions = form.querySelector('.form-actions');
        
        formGroups.forEach(group => {
          group.style.opacity = '0';
          group.style.pointerEvents = 'none';
        });
        
        if (formActions) {
          formActions.style.opacity = '0';
          formActions.style.pointerEvents = 'none';
        }
        
        // Show loading animation
        if (loadingState) {
          setTimeout(() => {
            loadingState.classList.add('show');
          }, 300); // Wait for form fade out
        }
        
        if (submitBtn) {
          submitBtn.disabled = true;
        }
      }

      // Show success message
      function showSuccess() {
        // Hide loading
        if (loadingState) {
          loadingState.classList.remove('show');
        }
        
        // Hide form fields
        const formGroups = form.querySelectorAll('.form-group');
        const formActions = form.querySelector('.form-actions');
        
        formGroups.forEach(group => {
          group.style.opacity = '0';
          group.style.pointerEvents = 'none';
        });
        
        if (formActions) {
          formActions.style.opacity = '0';
          formActions.style.pointerEvents = 'none';
        }
        
        if (successMessage) {
          successMessage.classList.add('show');
        }
        
        // Clear saved data on successful submission
        deleteCookie(COOKIE_NAME);
        setTimeout(() => {
          closeModal();
          clearFormData(); // Clear form after successful submission
        }, 4000); // Increased to 4 seconds to give more time to read
      }

      // Show error
      function showError(message) {
        loadingState.classList.remove('show');
        submitBtn.disabled = false;
        alert('Error: ' + message + '\n\nPlease try again or contact russoc2023@fau.edu directly.');
      }

      // Format form data for client email template
      function formatFormData(formData) {
        const budgetLabels = {
          'low': '50-100 USD',
          'medium': '100-500 USD',
          'high': '500-1000 USD',
          'critical': 'Infinite Money'
        };

        const categoryLabels = {
          'web': 'Website Development',
          'software': 'Backend Development',
          '3d': '3D-Printing / 3D-Modeling',
          'electronics': 'Electronics Prototyping',
          'training': 'Software Training',
          'other': 'Other'
        };

        // Get form values
        const name = formData.get('name') || '';
        const email = formData.get('email') || '';
        const phone = formData.get('phone') || 'Not provided';
        const urgency = formData.get('urgency') || '';
        const category = formData.get('category') || '';
        const description = formData.get('description') || '';
        const website = formData.get('device') || 'Not provided';
        
        return {
          // Email routing - CLIENT EMAIL ONLY GOES TO CHARLIE
          to_name: 'Charlie Russo',
          to_email: 'russoc2023@fau.edu',
          // NO CC - this ensures only Charlie gets the detailed client email
          
          // Client information
          from_name: name,
          from_email: email,
          reply_to: email,
          
          // All form fields with clear names
          name: name,
          email: email,
          phone: phone,
          urgency: urgency,
          category: category,
          description: description,
          device: website,
          
          // Formatted project details
          project_budget: budgetLabels[urgency] || urgency,
          project_category: categoryLabels[category] || category,
          project_description: description,
          existing_website: website,
          
          // Additional fields
          client_name: name,
          client_email: email,
          timestamp: new Date().toLocaleString(),
          
          // Complete message summary
          message: `NEW PROJECT INQUIRY

Client: ${name}
Email: ${email}
Phone: ${phone}
Website: ${website}

Project Budget: ${budgetLabels[urgency] || urgency}
Project Category: ${categoryLabels[category] || category}

Project Description:
${description}

Submitted: ${new Date().toLocaleString()}`
        };
      }

      // Format data for referral email template
      function formatReferralData(formData, referrerEmail) {
        const name = formData.get('name') || '';
        
        // Extract referrer name from email (everything before @)
        const referrerName = referrerEmail.split('@')[0].replace(/[._-]/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        
        return {
          // Email routing for referrer - REFERRAL EMAIL ONLY GOES TO REFERRER
          to_name: referrerName,
          to_email: referrerEmail,
          from_name: 'Charlie Russo',
          from_email: 'russoc2023@fau.edu',
          reply_to: 'russoc2023@fau.edu',
          
          // EmailJS template variables (matching your template configuration)
          email2: referrerEmail, // This is what your template expects for recipient
          from_email2: referrerEmail, // Alternative variable name for referral email
          from_name: name, // Client's name (safe to share - just the name)
          timestamp: new Date().toLocaleString()
          
          // NOTE: This template does NOT include sensitive client information like:
          // - Client email address
          // - Phone number
          // - Project budget
          // - Detailed project description
          // - Website information
          // Only the client's name is shared as a thank you
        };
      }

      // Submit form
      async function submitForm(e) {
        e.preventDefault();
        
        // Check if EmailJS is configured
        if (!EMAILJS_CONFIG.publicKey || EMAILJS_CONFIG.publicKey === 'YOUR_PUBLIC_KEY') {
          alert('EmailJS is not configured yet. Please provide your EmailJS credentials.');
          return;
        }

        showLoading();

        try {
          const formData = new FormData(form);
          const clientTemplateParams = formatFormData(formData);

          // Send client email (main inquiry)
          console.log('🔍 Sending client email with template:', EMAILJS_CONFIG.templateId);
          console.log('🔍 Sending client email with service:', EMAILJS_CONFIG.serviceId);
          console.log('🔍 Client template params:', clientTemplateParams);
          console.log('🔍 CRITICAL: Client email should go TO:', clientTemplateParams.to_email);
          console.log('🔍 CRITICAL: Client email FROM:', clientTemplateParams.from_email);
          console.log('🔍 CRITICAL: Client email REPLY_TO:', clientTemplateParams.reply_to);
          console.log('🔍 SECURITY: Client email contains sensitive data - should ONLY go to Charlie');
          
          const clientResponse = await emailjs.send(
            EMAILJS_CONFIG.serviceId,
            EMAILJS_CONFIG.templateId,
            clientTemplateParams,
            EMAILJS_CONFIG.publicKey
          );

          console.log('✅ Client email response:', clientResponse);

          if (clientResponse.status !== 200 && clientResponse.text !== 'OK') {
            throw new Error('Failed to send client email. Status: ' + clientResponse.status);
          }

          // Check for referrer and send referral email if exists
          const referrerEmail = getReferrer();
          console.log('🔍 Checking for referrer:', referrerEmail);
          console.log('🔍 Is valid email?', referrerEmail ? isValidEmail(referrerEmail) : 'No referrer found');
          
          if (referrerEmail && isValidEmail(referrerEmail)) {
            console.log('✅ Referrer found! Sending referral email...');
            console.log('🔍 SECURITY CHECK: Verifying referral email does not contain sensitive client data...');
            
            try {
              const referralTemplateParams = formatReferralData(formData, referrerEmail);
              
              // SECURITY CHECK: Ensure referral email doesn't contain sensitive data
              const sensitiveFields = ['email', 'phone', 'description', 'device', 'project_budget', 'project_description', 'existing_website'];
              const hasSensitiveData = sensitiveFields.some(field => referralTemplateParams[field]);
              
              if (hasSensitiveData) {
                console.error('🚨 SECURITY VIOLATION: Referral email contains sensitive client data!');
                console.error('🚨 Sensitive fields found:', sensitiveFields.filter(field => referralTemplateParams[field]));
                throw new Error('Security violation: Referral email contains sensitive client data');
              } else {
                console.log('✅ Security check passed: Referral email contains no sensitive client data');
              }
              
              // Send referral thank you email
              console.log('🔍 Sending referral email with template:', EMAILJS_CONFIG.referralTemplateId);
              console.log('🔍 Sending referral email with service:', EMAILJS_CONFIG.referralServiceId);
              console.log('🔍 Referral template params:', referralTemplateParams);
              console.log('🔍 CRITICAL: Referral email should go TO:', referralTemplateParams.to_email);
              console.log('🔍 CRITICAL: Referral email FROM:', referralTemplateParams.from_email);
              console.log('🔍 CRITICAL: Email2 (template recipient):', referralTemplateParams.email2);
              console.log('🔍 CRITICAL: From_email2 (referral email):', referralTemplateParams.from_email2);
              console.log('🔍 CRITICAL: Client name (from_name):', referralTemplateParams.from_name);
              console.log('🔍 CRITICAL: Timestamp:', referralTemplateParams.timestamp);
              console.log('🔍 SECURITY: Referral email contains NO sensitive data - only client name and thank you message');
              
              const referralResponse = await emailjs.send(
                EMAILJS_CONFIG.referralServiceId,
                EMAILJS_CONFIG.referralTemplateId,
                referralTemplateParams,
                EMAILJS_CONFIG.publicKey
              );

              console.log('✅ Referral email response:', referralResponse);
              console.log('📧 Referral email sent to:', referrerEmail);
              
              // Don't fail the whole process if referral email fails
              if (referralResponse.status !== 200 && referralResponse.text !== 'OK') {
                console.warn('⚠️ Referral email failed, but continuing with success flow. Status:', referralResponse.status);
              }
            } catch (referralError) {
              console.error('❌ Failed to send referral email:', referralError);
              console.error('❌ Referral error details:', {
                message: referralError.message,
                text: referralError.text,
                status: referralError.status
              });
              // Continue with success flow even if referral email fails
            }
          } else {
            console.log('❌ No referrer found or invalid email. Skipping referral email.');
          }

          showSuccess();
        } catch (error) {
          showError(error.text || error.message || 'Failed to send email. Please try again or contact us directly.');
        }
      }

      // Event listeners
      openBtn.addEventListener('click', openModal);
      closeBtn.addEventListener('click', closeModal);
      cancelBtn.addEventListener('click', closeModal);
      form.addEventListener('submit', submitForm);
      
      // Add success close button listener
      const successCloseBtn = $('#successCloseBtn');
      if (successCloseBtn) {
        successCloseBtn.addEventListener('click', closeModal);
      }

      // Close modal when clicking outside
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });

      // Close modal with Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          if (modal.classList.contains('show')) {
            closeModal();
          }
          if (qrModal.classList.contains('show')) {
            closeQrModal();
          }
        }
      });

      // QR Code functionality
      const qrButton = $('#qrButton');
      const qrModal = $('#qrModal');
      const closeQrBtn = $('#closeQrBtn');

      function openQrModal() {
        qrModal.style.display = 'grid';
        requestAnimationFrame(() => {
          qrModal.classList.add('show');
          qrModal.setAttribute('aria-hidden', 'false');
          document.body.style.overflow = 'hidden';
        });
      }

      function closeQrModal() {
        qrModal.classList.remove('show');
        qrModal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
        setTimeout(() => {
          qrModal.style.display = 'none';
        }, 300);
      }

      // QR Code Event Listeners
      qrButton.addEventListener('click', openQrModal);
      closeQrBtn.addEventListener('click', closeQrModal);
      qrModal.addEventListener('click', (e) => {
        if (e.target === qrModal) closeQrModal();
      });

      // Initialize functionality
      window.addEventListener('beforeunload', saveFormData);
      setupAutoSave();
      document.addEventListener('DOMContentLoaded', loadFormData);
    })();

    // ===== Affiliate Modal =====
    (function affiliateHandler() {
      // Modal elements
      const affiliateModal = $('#affiliateModal');
      const openAffiliateBtn = $('#openAffiliateBtn');
      const closeAffiliateBtn = $('#closeAffiliateBtn');
      const cancelAffiliateBtn = $('#cancelAffiliateBtn');
      const closeAffiliateSuccessBtn = $('#closeAffiliateSuccessBtn');
      const affiliateForm = $('#affiliateForm');
      const generateLinkBtn = $('#generateLinkBtn');
      const copyLinkBtn = $('#copyLinkBtn');
      const shareLinkBtn = $('#shareLinkBtn');
      const affiliateEmail = $('#affiliateEmail');
      const generatedLink = $('#generatedLink');
      const affiliateStep1 = $('#affiliateStep1');
      const affiliateStep2 = $('#affiliateStep2');

      // Open affiliate modal
      function openAffiliateModal() {
        document.body.style.overflow = 'hidden';
        affiliateModal.setAttribute('aria-hidden', 'false');
        
        // Reset to step 1
        affiliateStep1.style.display = 'block';
        affiliateStep2.style.display = 'none';
        affiliateForm.reset();
        
        // Trigger smooth fade in
        requestAnimationFrame(() => {
          affiliateModal.classList.add('show');
          
          // Animate form elements after container appears (same as client form)
          setTimeout(() => {
            animateAffiliateFormElements();
          }, 700); // Wait for form container to fully appear
        });
      }
      
      // Animate affiliate form elements (same as client form)
      function animateAffiliateFormElements() {
        const formGroups = affiliateForm.querySelectorAll('.form-group');
        const formActions = affiliateForm.querySelector('.form-actions');
        
        // Animate each form group with typing effect
        formGroups.forEach((group, index) => {
          setTimeout(() => {
            // Animate the group container
            group.classList.add('animate-in');
            
            // Animate label and input separately
            const label = group.querySelector('.form-label');
            const input = group.querySelector('.form-input');
            
            if (label) {
              setTimeout(() => {
                label.classList.add('animate-in');
              }, 200);
            }
            
            if (input) {
              setTimeout(() => {
                input.classList.add('animate-in');
                
                // Focus first empty field
                if (index === 0) {
                  setTimeout(() => {
                    affiliateEmail.focus();
                  }, 300);
                }
              }, 400);
            }
          }, index * 300); // Stagger each group by 300ms
        });
        
        // Animate form actions last
        if (formActions) {
          setTimeout(() => {
            formActions.style.opacity = '0';
            formActions.style.transform = 'translateY(20px)';
            formActions.style.transition = 'all 0.6s cubic-bezier(0.16, 1, 0.3, 1)';
            
            requestAnimationFrame(() => {
              formActions.style.opacity = '1';
              formActions.style.transform = 'translateY(0)';
            });
          }, formGroups.length * 300 + 200);
        }
      }

      // Close affiliate modal
      function closeAffiliateModal() {
        affiliateModal.classList.remove('show');
        affiliateModal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
        
        // Wait for fade out animation to complete
        setTimeout(() => {
          // Reset to step 1
          affiliateStep1.style.display = 'block';
          affiliateStep2.style.display = 'none';
          affiliateForm.reset();
        }, 500);
      }

      // Generate affiliate link
      function generateAffiliateLink(email) {
        // Get current domain - use the actual domain or fallback to current origin
        let currentDomain = window.location.origin;
        
        // If you want to use a specific domain instead of the current one, replace this:
        // currentDomain = 'https://charlierusso.dev';
        
        const affiliateLink = `${currentDomain}?ref=${encodeURIComponent(email)}`;
        console.log('🔗 Generated affiliate link:', affiliateLink);
        return affiliateLink;
      }
      
      // Display affiliate link with proper formatting
      function displayAffiliateLink(email, link) {
        // Create a user-friendly display version
        const displayText = `${window.location.origin}?ref=${email}`;
        console.log('🔗 Display text:', displayText);
        return displayText;
      }

      // Copy link to clipboard
      async function copyToClipboard(text) {
        try {
          await navigator.clipboard.writeText(text);
          
          // Show success feedback
          const originalText = copyLinkBtn.textContent;
          copyLinkBtn.textContent = 'Copied!';
          copyLinkBtn.style.background = 'var(--status-success)';
          
          setTimeout(() => {
            copyLinkBtn.textContent = originalText;
            copyLinkBtn.style.background = 'var(--btn-form-bg)';
          }, 2000);
        } catch (err) {
          console.error('Failed to copy: ', err);
          
          // Fallback for older browsers
          const textArea = document.createElement('textarea');
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          
          // Show success feedback
          const originalText = copyLinkBtn.textContent;
          copyLinkBtn.textContent = 'Copied!';
          copyLinkBtn.style.background = 'var(--status-success)';
          
          setTimeout(() => {
            copyLinkBtn.textContent = originalText;
            copyLinkBtn.style.background = 'var(--btn-form-bg)';
          }, 2000);
        }
      }

      // Share link
      function shareLink() {
        // Use the actual encoded link for sharing (stored in dataset)
        const link = generatedLink.dataset.actualLink || generatedLink.textContent;
        
        if (navigator.share) {
          // Use native sharing if available
          navigator.share({
            title: 'Charlie Russo Technical Services - Affiliate Link',
            text: 'Check out Charlie Russo Technical Services for development and prototyping needs!',
            url: link
          }).catch(err => {
            console.log('Error sharing:', err);
            copyToClipboard(link);
          });
        } else {
          // Fallback to copying
          copyToClipboard(link);
        }
      }

      // Handle form submission
      function handleAffiliateForm(e) {
        e.preventDefault();
        
        const email = affiliateEmail.value.trim();
        
        if (!email || !isValidEmail(email)) {
          alert('Please enter a valid email address.');
          return;
        }
        
        // Generate affiliate link (encoded for actual use)
        const link = generateAffiliateLink(email);
        console.log('🔍 Generated encoded link:', link);
        
        // Create display version (with proper @ symbol)
        const displayLink = displayAffiliateLink(email, link);
        console.log('🔍 Display link:', displayLink);
        
        // Set the display text content
        generatedLink.textContent = displayLink;
        
        // Store the actual encoded link for copying
        generatedLink.dataset.actualLink = link;
        
        // Verify the link was set
        console.log('🔍 Link text content after setting:', generatedLink.textContent);
        
        // Show step 2
        affiliateStep1.style.display = 'none';
        affiliateStep2.style.display = 'block';
        
        // Log affiliate signup (for your tracking)
        console.log('🎯 New affiliate signup:', email);
        console.log('🔗 Generated affiliate link:', link);
      }

      // Email validation helper
      function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }

      // Event listeners
      openAffiliateBtn.addEventListener('click', openAffiliateModal);
      closeAffiliateBtn.addEventListener('click', closeAffiliateModal);
      cancelAffiliateBtn.addEventListener('click', closeAffiliateModal);
      closeAffiliateSuccessBtn.addEventListener('click', closeAffiliateModal);
      affiliateForm.addEventListener('submit', handleAffiliateForm);
      copyLinkBtn.addEventListener('click', () => {
        // Use the actual encoded link for copying (stored in dataset)
        const actualLink = generatedLink.dataset.actualLink || generatedLink.textContent;
        copyToClipboard(actualLink);
      });
      shareLinkBtn.addEventListener('click', shareLink);

      // Close modal when clicking outside
      affiliateModal.addEventListener('click', (e) => {
        if (e.target === affiliateModal) closeAffiliateModal();
      });

      // Close modal with Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          if (affiliateModal.classList.contains('show')) {
            closeAffiliateModal();
          }
        }
      });

      // Debug function to test affiliate link generation
      window.testAffiliateLink = function(email) {
        if (!email) email = 'test@example.com';
        const link = generateAffiliateLink(email);
        console.log('🧪 Test affiliate link for', email, ':', link);
        console.log('🧪 Current domain:', window.location.origin);
        console.log('🧪 Generated link:', link);
        return link;
      };
      
      // Debug function to test the full affiliate flow
      window.testAffiliateFlow = function(email) {
        if (!email) email = 'test@example.com';
        console.log('🧪 Testing full affiliate flow with email:', email);
        
        // Test link generation
        const link = generateAffiliateLink(email);
        console.log('🧪 Generated link:', link);
        
        // Test setting the link in the text element
        if (generatedLink) {
          generatedLink.textContent = link;
          console.log('🧪 Link set in text element:', generatedLink.textContent);
        } else {
          console.log('🧪 Generated link element not found');
        }
        
        return link;
      };
    })();
  </script>
</body>
</html>
